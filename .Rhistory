dbExecute(mydb, "
CREATE TABLE customer (
id int(5) ,
country VARCHAR(30)
)")
dbExecute(mydb, "
INSERT INTO customer
SELECT DISTINCT `Customer ID`, Country
FROM retail
")
dbExecute(mydb, "
CREATE TABLE items (
stockCode varchar(10),
description VARCHAR(40),
price double
)")
dbExecute(mydb, "
INSERT INTO items
SELECT DISTINCT StockCode, Description, Price
FROM retail
")
dbExecute(mydb, "
CREATE TABLE orders (
invoice varchar(10),
date DATETIME,
stockCode varchar(10),
id int(5)
)")
dbExecute(mydb, "
INSERT INTO orders
SELECT Invoice, InvoiceDate, StockCode, `Customer ID`
FROM retail
")
add_to_table <- function(table, params) {
if (table == "orders"){
dbExecute(mydb, "
INSERT INTO orders (invoice, date, stockCode, id)
VALUES (?,?,?,?)",
params = params
)
} else if (table == "customer") {
dbExecute(mydb, "
INSERT INTO customer (id, country)
VALUES (?,?)",
params = params
)
} else if (table == "items") {
dbExecute(mydb, "
INSERT INTO items (stockCode, description, price)
VALUES (?,?,?)",
params = params
)
}
}
add_to_table("orders", list('676767', '2067-06-07 06:07:06', 22112, 13758))
dbGetQuery(mydb, "SELECT * FROM orders WHERE invoice = '676767'")
add_to_table("customer", list(676741, 'Hawaii'))
dbGetQuery(mydb, "SELECT * FROM customer WHERE id = '676741'")
add_to_table("items", list('6767a', 'Six Seven', 67.67))
dbGetQuery(mydb, "SELECT * FROM items WHERE stockCode = '6767a'")
dbExecute(mydb, "DELETE FROM customer WHERE id='676741'")
dbGetQuery(mydb, "SELECT * FROM customer WHERE id = '676741'")
dbExecute(mydb, "ALTER TABLE items DROP COLUMN price")
dbGetQuery(mydb, "SELECT * FROM items LIMIT 5")
dbExecute(mydb, "DROP TABLE items;")
# Also delete original table
dbExecute(mydb, "DROP TABLE items;")
# Also delete original table
dbExecute(mydb, "DROP TABLE retail;")
dbListTables(mydb)
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(DBI)
library(odbc)
library(RMySQL)
library(tidyverse)
library(dplyr)
library(nycflights13)
# Cite: https://www.kaggle.com/datasets/lakshmi25npathi/online-retail-dataset
retail <- read_excel('Desktop/online_retail_II.xlsx')
mydb <- dbConnect(RSQLite::SQLite(), ":memory:")
dbWriteTable(conn=mydb, name="retail", value=retail, append=TRUE, row.names=FALSE)
dbExecute(mydb, "
CREATE TABLE customer (
id int(5) ,
country VARCHAR(30)
)")
dbExecute(mydb, "
INSERT INTO customer
SELECT DISTINCT `Customer ID`, Country
FROM retail
")
dbExecute(mydb, "
CREATE TABLE items (
stockCode varchar(10),
description VARCHAR(40),
price double
)")
dbExecute(mydb, "
INSERT INTO items
SELECT DISTINCT StockCode, Description, Price
FROM retail
")
dbExecute(mydb, "
CREATE TABLE orders (
invoice varchar(10),
date DATETIME,
stockCode varchar(10),
id int(5)
)")
dbExecute(mydb, "
INSERT INTO orders
SELECT Invoice, InvoiceDate, StockCode, `Customer ID`
FROM retail
")
add_to_table <- function(table, params) {
if (table == "orders"){
dbExecute(mydb, "
INSERT INTO orders (invoice, date, stockCode, id)
VALUES (?,?,?,?)",
params = params
)
} else if (table == "customer") {
dbExecute(mydb, "
INSERT INTO customer (id, country)
VALUES (?,?)",
params = params
)
} else if (table == "items") {
dbExecute(mydb, "
INSERT INTO items (stockCode, description, price)
VALUES (?,?,?)",
params = params
)
}
}
add_to_table("orders", list('676767', '2067-06-07 06:07:06', 22112, 13758))
dbGetQuery(mydb, "SELECT * FROM orders WHERE invoice = '676767'")
add_to_table("customer", list(676741, 'Hawaii'))
dbGetQuery(mydb, "SELECT * FROM customer WHERE id = '676741'")
add_to_table("items", list('6767a', 'Six Seven', 67.67))
dbGetQuery(mydb, "SELECT * FROM items WHERE stockCode = '6767a'")
dbExecute(mydb, "DELETE FROM customer WHERE id='676741'")
dbGetQuery(mydb, "SELECT * FROM customer WHERE id = '676741'")
dbExecute(mydb, "ALTER TABLE items DROP COLUMN price")
dbGetQuery(mydb, "SELECT * FROM items LIMIT 5")
# Also delete original table
dbExecute(mydb, "DROP TABLE retail;")
dbListTables(mydb)
dbGetQuery(mydb, "SELECT COUNT(*) AS n FROM customer;")
dbGetQuery(mydb, "SELECT COUNT(*) AS n FROM items;")
dbGetQuery(mydb, "SELECT COUNT(*) AS n FROM orders;")
knitr::opts_chunk$set(echo = TRUE)
ggplot(q4, aes(x=temp, fill=tod)) +
geom_histogram(bins=3) +
facet_wrap(~airlineName)
ggplot(q4, aes(x=temp, fill=tod)) +
geom_histogram(bins=3) +
facet_wrap(~airlineName)
dbExecute(HW7DB, "CREATE TABLE 'weather' (
'origin' varchar(3) NOT NULL,
'year' int(4) NOT NULL,
'month' int(2) NOT NULL,
'day' int(2) NOT NULL,
'hour' double NOT NULL,
'temp' double,
'dewp' double,
'humid' double,
'wind_dir' int(4),
'wind_speed' double,
'wind_gust' double,
'precip' double,
'pressure' double,
'visib' double NOT NULL,
'time_hour' VARCHAR(20) NOT NULL
)")
HW7DB <- dbConnect(RSQLite::SQLite(), ":memory:")
dbExecute(HW7DB, "CREATE TABLE 'weather' (
'origin' varchar(3) NOT NULL,
'year' int(4) NOT NULL,
'month' int(2) NOT NULL,
'day' int(2) NOT NULL,
'hour' double NOT NULL,
'temp' double,
'dewp' double,
'humid' double,
'wind_dir' int(4),
'wind_speed' double,
'wind_gust' double,
'precip' double,
'pressure' double,
'visib' double NOT NULL,
'time_hour' VARCHAR(20) NOT NULL
)")
dbWriteTable(conn = HW7DB, name='weather', value = weather, append=TRUE, header=FALSE, row.names=FALSE)
dbExecute(HW7DB, "CREATE TABLE 'planes' (
'tailnum' varchar(8) NOT NULL,
'year' int(4),
'type' varchar(30) NOT NULL,
'manufacturer' varchar(20) NOT NULL,
'model' varchar(20) NOT NULL,
'engines' int(3) NOT NULL,
'seats' int(5) NOT NULL,
'speed' int(20),
'engine' varchar(30) NOT NULL
)")
dbWriteTable(conn = HW7DB, name='planes', value = planes, append=TRUE, header=FALSE, row.names=FALSE)
dbExecute(HW7DB, "CREATE TABLE 'flights' (
'year' int(11) NOT NULL,
'month' int(11) NOT NULL,
'day' int(11) NOT NULL,
'dep_time' int(11),
'sched_dep_time' int(11) NOT NULL,
'dep_delay' int(11),
'arr_time' int(11),
'sched_arr_time' int(11) NOT NULL,
'arr_delay' int(11),
'carrier' varchar(2) NOT NULL,
'flight' int(11) NOT NULL,
'tailnum' varchar(10),
'origin' varchar(3) NOT NULL,
'dest' varchar(3) NOT NULL,
'air_time' int(11),
'distance' int(11) NOT NULL,
'hour' int(11) NOT NULL,
'minute' int(11) NOT NULL,
'time_hour' VARCHAR(20) NOT NULL
)")
dbWriteTable(conn = HW7DB, name='flights', value = flights, append=TRUE, header=FALSE, row.names=FALSE)
dbExecute(HW7DB, "CREATE TABLE 'airports' (
'faa' varchar(3) NOT NULL,
'name' varchar(50) NOT NULL,
'lat' double NOT NULL,
'lon' double NOT NULL,
'alt' int(11) NOT NULL,
'tz' int(11) NOT NULL,
'dst' varchar(1) NOT NULL,
'tzone' varchar(40)
)")
dbWriteTable(conn = HW7DB, name='airports', value = airports, append=TRUE, header=FALSE, row.names=FALSE)
library(readr)
charts <- read.csv("charts.csv")
save.image("~/Desktop/charts.RData")
load("~/Desktop/charts.csv")
charts <- read.csv("desktop/charts.csv")
View(charts)
spotify <- read.csv("spotify_songs.csv")
spotify <- read.csv("desktop/spotify_songs.csv")
# combine charts
charts <- rbind(charts, charts2)
charts2 <- read.csv("desktop/charts2.csv")
# Reading data files and investigating
charts <- read.csv("desktop/charts.csv")
# combine charts
charts <- rbind(charts, charts2)
library(readr)
# Reading data files and investigating
charts <- read.csv("desktop/charts.csv")
library(readr)
# Reading data files and investigating
charts <- read.csv("desktop/charts.csv")
charts2 <- read.csv("desktop/charts2.csv")
View(spotify)
library(readr)
# Reading data files and investigating
charts <- read.csv("desktop/charts.csv")
charts2 <- read.csv("desktop/charts2.csv")
spotify <- read.csv("desktop/spotify_songs.csv")
# combine charts
charts_total <- rbind(charts, charts2)
library(readr)
# Reading data files and investigating
charts <- read.csv("desktop/charts.csv")
charts2 <- read.csv("desktop/charts2.csv")
spotify <- read.csv("desktop/spotify_songs.csv")
# combine charts
charts_total <- rbind(charts, charts2)
charts2 <- read.csv("desktop/charts2.csv")
# combine charts
charts_total <- rbind(charts, charts2)
charts_total <- rbind(charts, charts2)
View(charts)
# -------- Reading data files and investigating -----------
charts <- read.csv("desktop/charts.csv")
charts2 <- read.csv("desktop/charts2.csv")
# -------- Reading data files and investigating -----------
ufoData <- read.csv("Desktop/ufo.csv")
View(ufoData)
# -------- Reading data files and investigating -----------
ufoData <- read.csv("Desktop/ufo.csv")
View(ufoData)
#--------- Inspect Null ------------------
nrow(ufoData %>% where(is.na(datetime)))
library(dplyr)
#--------- Inspect Null ------------------
nrow(ufoData %>% where(is.na(datetime)))
#--------- Inspect Null ------------------
nrow(ufoData %>% filter(is.na(datetime)))
#--------- Inspect Null ------------------
nrow(ufoData %>% filter(is.na(datetime) || datetime == 0))
#--------- Inspect Null ------------------
nrow(ufoData %>% filter(is.na(datetime) | datetime == 0))
nrow(ufoData %>% filter(is.na(city)))
nrow(ufoData %>% filter(is.na(city) | city == ""))
ufoData %>% filter(is.na(datetime) || datetime == 0))
ufoData %>% filter(is.na(datetime) || datetime == 0)
ufoData %>% filter(is.na(city) | city == "")
#--------- Remove Null Weather ------------------
ufoData <- ufoData %>% filter(!is.na(datetime) | !(datetime == 0) %>% filter(!is.na(city) | !(city == ""))
nrow(ufoData)
nrow(ufoData)
#--------- Remove Null Weather ------------------
ufo_non_null <- ufoData %>% filter(!is.na(datetime) | !(datetime == 0) %>% filter(!is.na(city) | !(city == ""))
# -------- Reading data files and investigating -----------
ufoData <- read.csv("Desktop/ufo.csv")
# -------- Reading data files and investigating -----------
ufoData <- read.csv("Desktop/ufo.csv")
nrow(ufoData)
nrow(ufo_non_null)
#--------- Remove Null Weather ------------------
ufo_non_null <- ufoData %>% filter(!is.na(datetime) | !(datetime == 0) %>% filter(!is.na(city) | !(city == ""))
nrow(ufo_non_null)
nrow(ufo_non_null)
#--------- Remove Null Weather ------------------
ufo_non_null <- ufoData %>% filter(!is.na(datetime) | !(datetime == 0) %>% filter(!is.na(city) | !(city == ""))
nrow(ufo_non_null)
#--------- Remove Null Weather ------------------
ufo_non_null <- ufoData %>% filter(!is.na(datetime) | !(datetime == 0)) %>% filter(!is.na(city) | !(city == ""))
nrow(ufo_non_null)
nrow(ufoData)
nrow(ufo_non_null)
#--------- Remove Null Weather ------------------
ufo_non_null <- ufoData %>% filter(!is.na(datetime) & !(datetime == 0)) %>% filter(!is.na(city) & !(city == ""))
nrow(ufo_non_null)
weatherData <- read.csv("Desktop/weather.csv")
#--------- Inspect Null Weather ------------------
nrow(ufoData %>% filter(is.na(datetime) | datetime == 0)) # 196 null time rows
View(weatherData)
nrow(weatherData %>% filter(is.na(Date Time) | `Date Time` == ""))
nrow(weatherData %>% filter(is.na(`Date Time`) | `Date Time` == ""))
nrow(weatherData %>% filter(is.na(Date_Time) | Date_Time == ""))
#---------- Inspect Weather ----------
nrow(weatherData %>% filter(is.na(Location) | Location == ""))
range(ufo_non_null$datetime)
range(weatherData$Date_Time)
history <- read.csv("Desktop/spotify_history.csv")
# -------- Reading data files and investigating -----------
songs <- read.csv("Desktop/spotify_songs.csv")
# -------- Reading data files and investigating -----------
songs <- read.csv("Desktop/spotify_songs.csv")
history <- read.csv("Desktop/spotify_history.csv")
View(history)
View(songs)
# ----- Inspect Data for Null values --------------------
nrow(is.na(songs$track_name))
nrow(is.na(history$track_name))
# ----- Inspect Data for Null values --------------------
nrow(songs %>% filter(track_name))
# ----- Inspect Data for Null values --------------------
nrow(songs %>% filter(is.na(track_name))
# ----- Inspect Data for Null values --------------------
nrow(songs %>% filter(is.na(track_name))
# ----- Inspect Data for Null values --------------------
nrow(songs %>% filter(is.na(track_name)))
nrow(history %>% filter(is.na(track_name)))
# ---------- Clean Nulls ----------------
songs <- songs %>% filter(!is.na(track_name))
# ----------- Inner Join ------------------
combined <- inner_join(songs, history, by = "track_name")
# ---------- Remove Where Song is not listened to --------------
history <- history %>% filter(ms_played != 0)
# ----------- Calculate Group Stats -----------
history <- history %>% group_by(track_name) %>% summarize(
mean_ms_played = mean(ms_played),
skip_percentage = mean(skipped),
autoplay_percentage = mean(reason_start == "autoplay"),
nextbtn_percentage = mean(reason_start == "nextbtn"),
selected_percentage = mean(reason_start == "clickrow"),
finished_percentage = mean(reason_start == "trackdone"),
)
# ----------- Calculate Group Stats -----------
history <- history %>% group_by(track_name) %>% summarize(
mean_ms_played = mean(ms_played),
skip_percentage = mean(skipped),
autoplay_percentage = mean(reason_start == "autoplay", na.rm=TRUE),
nextbtn_percentage = mean(reason_start == "nextbtn", na.rm=TRUE),
selected_percentage = mean(reason_start == "clickrow", na.rm=TRUE),
finished_percentage = mean(reason_start == "trackdone", na.rm=TRUE),
)
# ----------- Inner Join ------------------
combined <- inner_join(songs, history, by = "track_name")
# ----------- Calculate Group Stats -----------
history <- history %>% group_by(track_name) %>% summarize(
mean_ms_played = mean(ms_played),
skip_percentage = mean(skipped),
autoplay_percentage = mean(reason_start == "autoplay", na.rm = TRUE),
nextbtn_percentage = mean(reason_start == "nextbtn", na.rm =  TRUE),
selected_percentage = mean(reason_start == "clickrow", na.rm = TRUE),
finished_percentage = mean(reason_start == "trackdone", na.rm = TRUE),
)
history <- read.csv("Desktop/spotify_history.csv")
# ---------- Remove Where Song is not listened to --------------
history <- history %>% filter(ms_played != 0)
# ----------- Calculate Group Stats -----------
history_select <- history %>% select(-ts, -platform, -reason_end, -shuffle)
history_summarized <- history_select %>% group_by(track_name) %>% summarize(
mean_ms_played = mean(ms_played),
skip_percentage = mean(skipped),
autoplay_percentage = mean(reason_start == "autoplay", na.rm = TRUE),
nextbtn_percentage = mean(reason_start == "nextbtn", na.rm =  TRUE),
selected_percentage = mean(reason_start == "clickrow", na.rm = TRUE),
finished_percentage = mean(reason_start == "trackdone", na.rm = TRUE),
)
View(history_summarized)
# ----------- Calculate Group Stats -----------
history_select <- history %>% select(-ts, -platform, -reason_end, -shuffle)
history_summarized <- history_select %>% group_by(track_name) %>% summarize(
mean_ms_played = mean(ms_played),
skip_percentage = mean(skipped),
autoplay_percentage = mean(reason_start == "autoplay", na.rm = TRUE),
nextbtn_percentage = mean(reason_start == "nextbtn", na.rm =  TRUE),
selected_percentage = mean(reason_start == "clickrow", na.rm = TRUE),
finished_percentage = mean(reason_start == "trackdone", na.rm = TRUE),
listens = n(),
)
# -------- Filter Small Sample Sizes --------------
history_size <- history_summarized %>% where(listeners >= 5)
# -------- Filter Small Sample Sizes --------------
history_size <- history_summarized %>% filter(listeners >= 5)
# -------- Filter Small Sample Sizes --------------
history_size <- history_summarized %>% filter(listens >= 5)
View(history_size)
# -------- Filter Small Sample Sizes --------------
history_size <- history_summarized %>% filter(listens >= 20)
history_summarized <- history_select %>% group_by(track_name) %>% summarize(
mean_ms_played = mean(ms_played, na.rm = TRUE),
skip_percentage = mean(skipped, na.rm = TRUE),
autoplay_percentage = mean(reason_start == "autoplay", na.rm = TRUE),
nextbtn_percentage = mean(reason_start == "nextbtn", na.rm =  TRUE),
selected_percentage = mean(reason_start == "clickrow", na.rm = TRUE),
finished_percentage = mean(reason_start == "trackdone", na.rm = TRUE),
listens = n(),
)
# -------- Filter Small Sample Sizes --------------
history_size <- history_summarized %>% filter(listens >= 20)
# ----------- Inner Join ------------------
combined <- inner_join(songs, history_size, by = "track_name")
View(combined)
history_select <- history %>% select(-ts, -platform, -reason_end, -shuffle)
history_summarized <- history_select %>% group_by(track_name) %>% summarize(
mean_ms_played = mean(ms_played, na.rm = TRUE),
skip_percentage = mean(skipped, na.rm = TRUE),
autoplay_percentage = mean(reason_start == "autoplay", na.rm = TRUE),
nextbtn_percentage = mean(reason_start == "nextbtn", na.rm =  TRUE),
selected_percentage = mean(reason_start == "clickrow", na.rm = TRUE),
finished_percentage = mean(reason_start == "trackdone", na.rm = TRUE),
listens = n(),
)
history_summarized <- history_select %>% group_by(track_name) %>% summarize(
mean_ms_played = mean(ms_played, na.rm = TRUE),
skip_percentage = mean(skipped, na.rm = TRUE),
intentional_percentage = mean(reason_start == "clickrow", na.rm = TRUE),
unintentional_percantage = mean(reason_start != "clickrow", na.rm = TRUE),
finished_percentage = mean(reason_start == "trackdone", na.rm = TRUE),
listens = n(),
)
# -------- Filter Small Sample Sizes --------------
history_size <- history_summarized %>% filter(listens >= 20)
songs_select <- songs %>%
select(-track_id, -track_album_id, -track_album_name, -playlist_id)
songs_select <- songs %>%
select(-track_id, -track_album_id, -track_album_name, -playlist_id)
history_summarized <- history_select %>% group_by(track_name) %>% summarize(
mean_ms_played = mean(ms_played, na.rm = TRUE)/ms_played,
skip_percentage = mean(skipped, na.rm = TRUE),
intentional_percentage = mean(reason_start == "clickrow", na.rm = TRUE),
unintentional_percantage = mean(reason_start != "clickrow", na.rm = TRUE),
finished_percentage = mean(reason_start == "trackdone", na.rm = TRUE),
listens = n(),
)
history_summarized <- history_select %>% group_by(track_name) %>% summarize(
mean_ms_played_percentage = mean(ms_played, na.rm = TRUE),
skip_percentage = mean(skipped, na.rm = TRUE),
intentional_percentage = mean(reason_start == "clickrow", na.rm = TRUE),
unintentional_percantage = mean(reason_start != "clickrow", na.rm = TRUE),
finished_percentage = mean(reason_start == "trackdone", na.rm = TRUE),
listens = n(),
)
# ----------- Compute mean_ms_played over duration ------------
combined_time <- combined %>% mutate(playing_time_percentage = mean_ms_played / duration)
# ----------- Compute mean_ms_played over duration ------------
combined_time <- combined %>% mutate(playing_time_percentage = mean_ms_played / duration_ms)
combined_time_rm <- combined_time %>% select(-mean_ms_played)
shiny::runApp('DataScience/final')
runApp('DataScience/final')
runApp('DataScience/final')
runApp('DataScience/final')
View(history)
runApp('DataScience/final')
runApp('DataScience/final')
install.packages(betareg)
install.packages("betareg")
runApp('DataScience/final')
install.packages("glm")
runApp('DataScience/final')
runApp('DataScience/final')
runApp('DataScience/final')
runApp('DataScience/final')
skipped
runApp('DataScience/final')
runApp('DataScience/final')
runApp('DataScience/final')
